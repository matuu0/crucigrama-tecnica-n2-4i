<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,viewport-fit=cover" />
<title>Crucigrama — Métodos y prevención</title>
<meta name="robots" content="noindex,nofollow">
<style>
:root{
  --bg:#eaf6ff;
  --card:#ffffff;
  --muted:#5b6b7a;
  --accent:#5bb8f2;
  --accent-2:#2e9ad9;
  --success:#16a34a;
  --danger:#ef4444;
  --radius:12px;
  --shadow:0 10px 30px rgba(26,39,57,0.08);
  --gap:12px;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  background:linear-gradient(180deg,var(--bg),#dff4ff);
  color:#07304a;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:14px;
  -webkit-font-smoothing:antialiased;
  -webkit-text-size-adjust:100%;
}

/* wrapper */
.wrap{
  width:100%;
  max-width:1100px;
  background:var(--card);
  padding:18px;
  border-radius:16px;
  box-shadow:var(--shadow);
}

/* header */
header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
h1{font-size:20px;margin:0;color:#05293e}
.subtitle{color:var(--muted);font-size:13px}

/* layout */
.grid{display:grid;grid-template-columns:1fr 340px;gap:16px;margin-top:12px}
@media (max-width:880px){.grid{grid-template-columns:1fr;gap:12px}}

/* board */
.board{background:linear-gradient(180deg,#ffffff,#f6fdff);padding:14px;border-radius:12px;border:1px solid rgba(8,58,86,0.04)}
.entries{display:flex;flex-wrap:wrap;gap:10px}
.entry{
  background:linear-gradient(180deg,#fbfeff,#eef9ff);
  border:1px solid rgba(10,74,110,0.04);
  padding:12px;border-radius:10px;min-width:0;flex:1 1 150px;
  text-align:left;font-weight:700;color:#03314a;cursor:pointer;transition:transform .12s ease,box-shadow .12s ease;
  display:flex;flex-direction:column;justify-content:center;
}
.entry:active{transform:translateY(0)}
.entry:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(46,154,217,0.08)}
.entry .num{font-size:12px;color:var(--muted);opacity:.95}
.entry .val{margin-top:8px;letter-spacing:2px;font-size:15px;word-break:break-word}

/* controls */
.controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.btn{background:var(--accent);border:none;color:white;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:800;box-shadow:0 6px 14px rgba(46,154,217,0.12)}
.btn.ghost{background:transparent;border:1px dashed rgba(7,48,74,0.06);color:var(--accent-2);box-shadow:none;font-weight:700}
.btn.surrender{background:#ffb4b4;color:#7a1b1b}
.small{font-size:13px;color:var(--muted)}

/* right panel */
.panel{background:linear-gradient(180deg,#f7feff,#f0fbff);padding:12px;border-radius:12px;border:1px solid rgba(10,74,110,0.03)}
.hintTitle{font-weight:800;margin-bottom:8px;color:#06314a}
.clue{font-size:14px;color:#084159;margin-bottom:8px}
.log{background:rgba(5,40,60,0.03);padding:8px;border-radius:8px;min-height:120px;max-height:320px;overflow:auto;font-size:13px;color:#043446}

/* modal */
.modalBack{position:fixed;inset:0;background:rgba(2,14,20,0.35);display:none;align-items:center;justify-content:center;padding:12px;z-index:120}
.modal{width:100%;max-width:520px;background:var(--card);padding:18px;border-radius:14px;border:1px solid rgba(8,58,86,0.06);box-shadow:var(--shadow)}
.formRow{display:flex;gap:8px;align-items:center;margin-top:8px}
input[type="text"]{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(8,58,86,0.06);background:#f8feff;color:#05293e;font-size:15px}
.modal .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
.msg{font-size:14px;margin-top:8px}
.msg.ok{color:var(--success)}
.msg.bad{color:var(--danger)}

/* stats & progress */
.stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px}
.statCard{background:linear-gradient(180deg,#ffffff,#f6fdff);padding:10px;border-radius:10px;border:1px solid rgba(8,58,86,0.03);text-align:center}
.statCard .num{font-weight:800;font-size:18px;color:#023047}
.statCard .label{font-size:12px;color:var(--muted)}
.progressWrap{margin-top:12px}
.progressBar{height:12px;background:rgba(2,54,86,0.06);border-radius:999px;overflow:hidden}
.progressFill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent-2));width:0%;transition:width .35s ease}

/* mobile-specific tweaks */
@media (max-width:880px){
  body{padding:8px}
  .wrap{padding:12px;border-radius:12px}
  .entries{flex-direction:column}
  .entry{flex:0 0 auto;width:100%;text-align:left;padding:12px}
  .controls{justify-content:flex-start}
  .panel{padding:10px}
}

/* Special force for in-app browsers (Instagram/TikTok) */
@media screen and (max-width: 650px){
  .grid{display:block !important}
  aside{width:100% !important;margin-top:12px !important}
  .entries{display:flex !important;flex-direction:column !important;width:100% !important}
  .entry{width:100% !important;flex:none !important;padding:14px !important;border-radius:12px}
  .wrap{padding:12px !important}
}

/* extra tiny phones */
@media (max-width:420px){
  h1{font-size:18px}
  .entry .val{font-size:14px}
  input[type="text"]{font-size:14px;padding:8px}
  .btn{padding:9px 10px}
}
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="Crucigrama público">
    <header>
      <div>
        <h1>Crucigrama — Métodos y prevención</h1>
        <div class="subtitle">Celeste suave — responsive & compatible</div>
      </div>
      <div class="small">Compartí el enlace o el QR con tu público</div>
    </header>

    <div class="grid">
      <section>
        <div class="board" id="board" aria-live="polite">
          <div class="entries" id="entries" role="list"></div>

          <div class="progressWrap">
            <div class="small">Progreso</div>
            <div class="progressBar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div class="progressFill" id="progressFill"></div>
            </div>
          </div>

          <div class="stats" id="statsArea" aria-hidden="false">
            <div class="statCard">
              <div class="num" id="statAttempts">0</div>
              <div class="label">Intentos totales</div>
            </div>
            <div class="statCard">
              <div class="num" id="statCorrect">0</div>
              <div class="label">Correctas</div>
            </div>
            <div class="statCard">
              <div class="num" id="statIncorrect">0</div>
              <div class="label">Incorrectas</div>
            </div>
            <div class="statCard">
              <div class="num" id="statAccuracy">0%</div>
              <div class="label">Porcentaje</div>
            </div>
          </div>

          <div class="status small" id="status" style="margin-top:10px"></div>
        </div>

        <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
          <button class="btn" id="startBtn">Jugar — Empezar</button>
          <button class="btn ghost" id="rulesBtn">Cómo jugar</button>
          <button class="btn surrender" id="surrenderBtn">Rendirse</button>
          <button class="btn" id="resetBtn">Reiniciar</button>
        </div>
      </section>

      <aside>
        <div class="panel">
          <div class="hintTitle">Pistas (respondé la palabra completa)</div>
          <div id="clues"></div>

          <div style="height:12px"></div>
          <div class="small">Registro de actividad</div>
          <div class="log" id="log" aria-live="polite"></div>
        </div>
      </aside>
    </div>

    <footer style="margin-top:12px;color:var(--muted);font-size:13px;text-align:center">
      Diseñado para uso público — acepta mayúsculas, tildes y espacios
    </footer>
  </div>

  <!-- Modal -->
  <div class="modalBack" id="modalBack" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Responder palabra #<span id="modalNum">1</span></h3>
      <div class="small" id="modalClue">pista...</div>

      <div class="formRow">
        <input id="answerInput" type="text" inputmode="text" autocomplete="off" placeholder="Escribí la palabra completa">
        <button class="btn" id="submitAnswer">Enviar</button>
      </div>

      <div class="actions">
        <button class="btn ghost" id="cancelBtn">Cancelar</button>
      </div>

      <div class="msg" id="modalMsg"></div>
    </div>
  </div>

<script>
/* ------------------------------
   LÓGICA: mantiene formato original
   ------------------------------ */

// normalize (remove diacritics, lowercase, remove non-alphanum)
function normalize(s){
  if(!s) return '';
  s = s.normalize('NFKD').replace(/[\u0300-\u036f]/g,'');
  s = s.toLowerCase();
  s = s.replace(/[^a-z0-9]/g,'');
  return s;
}

// accepted answers (variants)
const accepted = {
  1: ['diafragmas','diafragma'],
  2: ['anillo'],
  3: ['pastillas','pastilla'],
  4: ['inyeccion','inyectable','inyección'],
  5: ['infeccion','infección'],
  6: ['condon','condón','condom'],
  7: ['calendario'],
  8: ['parche'],
  9: ['sexualidad'],
  10: ['espermicida','espermicidas'],
  11: ['implante'],
  12: ['diu','d i u'],
  13: ['vasectomia','vasectomía'],
  14: ['pildoras','píldoras','pildora'],
  15: ['abstinencia']
};
// normalize accepted lists
Object.keys(accepted).forEach(k=>{
  accepted[k] = Array.from(new Set(accepted[k].map(normalize)));
});

// replacements for display (same as Pascal)
const replacements = {
  1:'D I A F R A G M A S',2:'A N I L L O',3:'P A S T I L L A S',4:'I N Y E C C I O N',
  5:'I N F E C C I O N',6:'C O N D O N',7:'C A L E N D A R I O',8:'P A R C H E',
  9:'S E X U A L I D A D',10:'E S P E R M I C I D A',11:'I M P L A N T E',12:'D I U',
  13:'V A S E C T O M I A',14:'P I L D O R A S',15:'A B S T I N E N C I A'
};

// pistas (usadas para modal)
const clues = {
  1:'dispositivo de silicona con forma de cúpula que se inserta en la vagina',
  2:'método anticonceptivo femenino flexible que va dentro de la vagina',
  3:'se toman el día después de tener relaciones sexuales, son de emergencia',
  4:'método anticonceptivo hormonal que espesa el moco cervical y se aplica cada 3 meses',
  5:'cuando ingresa un germen o agente patógeno genera una...',
  6:'funda delgada, generalmente de látex que se coloca sobre el pene',
  7:'método basado en registrar las fechas de la menstruación y calcular días fértiles',
  8:'método de prevención que libera hormonas a través de la piel para detener la ovulación y espesar el moco cervical',
  9:'es el modo en que cada persona experimenta el amor, el deseo y el afecto hacia otras personas',
  10:'sustancia química utilizada que destruye los espermatozoides y acompaña otro método anticonceptivo',
  11:'dispositivo chico similar a una varilla flexible que se inserta debajo de la piel',
  12:'dispositivo chico de plástico en forma de "T" que se inserta en el útero',
  13:'consiste en una cirugía para cortar o bloquear los conductos deferentes masculinos',
  14:'se toman todos los días e inhibe la ovulación',
  15:'consiste decidir de no tener relaciones sexuales'
};

// estado inicial (formato con guiones y letras)
const initial = {
  A:'_ _ A _ _ _ _ _ _', N:'_ N _ _ _', T:'_ _ _ T _ _ _ _ _',
  I1:'I _ _ _ _ _ _ _ _', C:'_ _ _ _ C _ _ _ _', O:'_ O _ _ _ _',
  N1:'_ _ _ _ N _ _ _ _ _', C1:'_ _ _ C _ _', E:'_ E _ _ _ _ _ _ _ _',
  P1:'_ _ P _ _ _ _ _ _ _ _', T1:'_ _ _ _ _ _ T _', I2:'_ I _',
  V:'V _ _ _ _ _ _ _ _ _', O1:'_ _ _ _ O _ _ _', S:'_ _ S _ _ _ _ _ _ _ _'
};

let state = {...initial, solvedCount:0, surrendered:false};
let stats = {attempts:0,correct:0,incorrect:0,perWordAttempts:{}};

// DOM refs
const entriesEl = document.getElementById('entries');
const cluesEl = document.getElementById('clues');
const logEl = document.getElementById('log');
const progressFill = document.getElementById('progressFill');
const statusEl = document.getElementById('status');
const statAttempts = document.getElementById('statAttempts');
const statCorrect = document.getElementById('statCorrect');
const statIncorrect = document.getElementById('statIncorrect');
const statAccuracy = document.getElementById('statAccuracy');

const modalBack = document.getElementById('modalBack');
const modalNum = document.getElementById('modalNum');
const modalClue = document.getElementById('modalClue');
const modalMsg = document.getElementById('modalMsg');
const answerInput = document.getElementById('answerInput');
const submitAnswer = document.getElementById('submitAnswer');
const cancelBtn = document.getElementById('cancelBtn');

const startBtn = document.getElementById('startBtn');
const rulesBtn = document.getElementById('rulesBtn');
const surrenderBtn = document.getElementById('surrenderBtn');
const resetBtn = document.getElementById('resetBtn');

// render entries & clues
function renderEntries(){
  entriesEl.innerHTML = '';
  const fixedList = [
    {n:1,key:'A'},{n:2,key:'N'},{n:3,key:'T'},{n:4,key:'I1'},
    {n:5,key:'C'},{n:6,key:'O'},{n:7,key:'N1'},{n:8,key:'C1'},
    {n:9,key:'E'},{n:10,key:'P1'},{n:11,key:'T1'},{n:12,key:'I2'},
    {n:13,key:'V'},{n:14,key:'O1'},{n:15,key:'S'}
  ];
  fixedList.forEach(item=>{
    const d = document.createElement('div');
    d.className = 'entry';
    d.tabIndex = 0;
    d.innerHTML = `<div class="num">#${item.n}</div><div class="val" id="val-${item.key}">${state[item.key]}</div>`;
    d.addEventListener('click', ()=>openModal(item.n));
    d.addEventListener('keydown', (e)=>{ if(e.key==='Enter') openModal(item.n); });
    entriesEl.appendChild(d);
  });
}

function renderClues(){
  cluesEl.innerHTML = '';
  for(let i=1;i<=15;i++){
    const el = document.createElement('div');
    el.className = 'clue';
    el.textContent = `${i}. ${clues[i]}`;
    cluesEl.appendChild(el);
  }
}

// logging
function log(msg,type){
  const el = document.createElement('div');
  el.textContent = msg;
  if(type==='err') el.style.color = 'var(--danger)';
  if(type==='ok') el.style.color = 'var(--success)';
  logEl.appendChild(el);
  logEl.scrollTop = logEl.scrollHeight;
}

// stats update
function updateStatsUI(){
  statAttempts.textContent = stats.attempts;
  statCorrect.textContent = stats.correct;
  statIncorrect.textContent = stats.incorrect;
  statAccuracy.textContent = (stats.attempts ? Math.round(stats.correct/stats.attempts*100) : 0) + '%';
  const pct = Math.round((state.solvedCount / 15) * 100);
  progressFill.style.width = pct + '%';
  statusEl.textContent = state.surrendered ? 'Te rendiste.' : (state.solvedCount >= 15 ? 'Felicidades, ganaste!' : `Resueltas: ${state.solvedCount} / 15`);
}

// modal control
let activeNum = null;
function openModal(n){
  if(state.surrendered) { log('Juego finalizado. Reinicia para jugar de nuevo.'); return; }
  if(state.solvedCount >= 15) { log('Juego completado.'); return; }
  activeNum = n;
  modalNum.textContent = n;
  modalClue.textContent = clues[n] || '';
  modalMsg.textContent = '';
  answerInput.value = '';
  modalBack.style.display = 'flex';
  modalBack.setAttribute('aria-hidden','false');
  setTimeout(()=>answerInput.focus(),120);
}
function closeModal(){
  modalBack.style.display = 'none';
  modalBack.setAttribute('aria-hidden','true');
  activeNum = null;
}

// submit answer
function submitModal(){
  if(activeNum === null) return;
  let raw = (answerInput.value || '').trim();
  if(raw.length === 0){ modalMsg.textContent = 'Escribí una respuesta.'; modalMsg.className = 'msg bad'; return; }
  const norm = normalize(raw);
  stats.attempts++;
  stats.perWordAttempts[activeNum] = (stats.perWordAttempts[activeNum] || 0) + 1;
  const list = accepted[activeNum] || [];
  if(list.includes(norm)){
    stats.correct++;
    state.solvedCount++;
    // set corresponding state key
    const keys = ['A','N','T','I1','C','O','N1','C1','E','P1','T1','I2','V','O1','S'];
    const key = keys[activeNum-1];
    state[key] = replacements[activeNum];
    const el = document.getElementById('val-'+key);
    if(el) el.textContent = state[key];
    log(`Correcto (#${activeNum}): ${raw}`,'ok');
    modalMsg.textContent = '¡Correcto!'; modalMsg.className = 'msg ok';
    updateStatsUI();
    setTimeout(()=>closeModal(),650);
  } else {
    stats.incorrect++;
    log(`Incorrecto (#${activeNum}): ${raw}`,'err');
    modalMsg.textContent = 'Incorrecto. Probá otra vez.'; modalMsg.className = 'msg bad';
    updateStatsUI();
  }
}

// surrender
function doSurrender(){
  if(confirm('¿Querés rendirte? (esto finalizará el juego)')){
    state.surrendered = true;
    updateStatsUI();
    log('Usuario se rindió.');
    // show final summary
    openFinal('Te rendiste. Gracias por jugar.');
  }
}

// final modal with summary
function openFinal(msg){
  modalNum.textContent = '';
  modalClue.textContent = msg;
  modalMsg.textContent = '';
  answerInput.value = '';
  submitAnswer.style.display = 'none';
  cancelBtn.textContent = 'Cerrar';
  showSummary();
  modalBack.style.display = 'flex';
  modalBack.setAttribute('aria-hidden','false');
}

function showSummary(){
  const hardest = computeHardest();
  const summary = `--- RESUMEN ---
Intentos: ${stats.attempts}
Correctas: ${stats.correct}
Incorrectas: ${stats.incorrect}
Palabra más intentada: ${hardest || 'N/A'}
`;
  log(summary);
  modalMsg.textContent = summary;
  modalMsg.className = 'msg';
}

function computeHardest(){
  let max = 0, idx = null;
  for(const k in stats.perWordAttempts){
    if(stats.perWordAttempts[k] > max){ max = stats.perWordAttempts[k]; idx = k; }
  }
  return idx ? `${idx} (${max} intentos)` : null;
}

// reset
function resetGame(){
  state = {...initial, solvedCount:0, surrendered:false};
  stats = {attempts:0,correct:0,incorrect:0,perWordAttempts:{}};
  submitAnswer.style.display = '';
  cancelBtn.textContent = 'Cancelar';
  logEl.innerHTML = '';
  modalMsg.textContent = '';
  renderEntries();
  renderClues();
  updateStatsUI();
}

// event handlers
submitAnswer.addEventListener('click', submitModal);
answerInput.addEventListener('keydown', function(e){ if(e.key === 'Enter') submitModal(); });
cancelBtn.addEventListener('click', function(){ submitAnswer.style.display = ''; cancelBtn.textContent = 'Cancelar'; closeModal(); });
modalBack.addEventListener('click', function(e){ if(e.target === modalBack){ submitAnswer.style.display = ''; cancelBtn.textContent = 'Cancelar'; closeModal(); } });

startBtn.addEventListener('click', function(){ if(!stats.startedAt) stats.startedAt = Date.now(); openModal(1); });
rulesBtn.addEventListener('click', function(){ alert('Cómo jugar:\\n1) Tocá un número (1-15).\\n2) Escribí la palabra completa.\\n3) 16 = Rendirse.\\n4) El tablero se actualiza cuando acertás.'); });
surrenderBtn.addEventListener('click', doSurrender);
resetBtn.addEventListener('click', function(){ if(confirm('Reiniciar el juego?')) resetGame(); });

// init
renderEntries();
renderClues();
updateStatsUI();
log('Juego listo — tocá un número para comenzar.');
</script>
</body>
</html>
